name: Build and Deploy GROMACS
description: Build a Docker container with GROMACS and run a molecular dynamics simulation as a Kubernetes Job.
plan:
- agent: build
  context:
    environment: "google cloud CPU instance in Kubernetes with MPI"
    application: gromacs
    load: true
    max_attempts: 10
    details: |      
      Download http://ftp.gromacs.org/pub/gromacs/gromacs-2024.2.tar.gz and compile with MPI support.              
      Ensure the WORKDIR is ./tests/regressiontests-2024.2/complex/argon relative to the build directory.

- agent: kubernetes-job
  context:
    no_pull: true
    environment: "google cloud CPU instance in Kubernetes"
    max_attempts: 10
    details: |
      Execute the molecular dynamics simulation using the 'gmx_mpi mdrun' command.      
      Use the reference_s.tpr in the working directory of the container with 8 CPU cores.
